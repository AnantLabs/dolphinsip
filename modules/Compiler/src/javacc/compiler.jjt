options{  JAVA_UNICODE_ESCAPE = true;  ERROR_REPORTING = false;  STATIC = false;}PARSER_BEGIN(RuleCompiler)package com.dsc.dip.etl.compiler.jcc;import java.io.*;import java.util.*;import org.apache.log4j.Logger;import com.dsc.dip.etl.compiler.bean.*;public class RuleCompiler{  private final static Logger LOGGER = Logger.getLogger(RuleCompiler.class );  // Hastable for storing typedef typesprivate static Set types = new HashSet();  public static RuleCompiler compile(Reader input){    LOGGER.info("Create rule compiler for rule source file :"+input);    RuleCompiler c = new RuleCompiler(input);    return c;  }  // Returns true if the given string is// a typedef type.private static boolean isType(String type){    return types.contains(type);  }  public static void dump(SimpleNode e, String prefix){    LOGGER.debug(e.toString(prefix)+":"+e.jjtGetValue());    for (int i = 0;    i<e.jjtGetNumChildren();    ++i){      SimpleNode n = (SimpleNode)e.jjtGetChild(i);      if (n != null){        dump(n, prefix+"\t");      }    }  }}PARSER_END(RuleCompiler)/* WHITE SPACE */SKIP:{  " "  | "\t"  | "\n"  | "\r"  | "\r\n"  | "\f"}/* COMMENTS */MORE:{  "//":IN_SINGLE_LINE_COMMENT  | <"/**"~["/"]>{    input_stream.backup(1);  }  :IN_FORMAL_COMMENT  | "/*":IN_MULTI_LINE_COMMENT}<IN_SINGLE_LINE_COMMENT>SPECIAL_TOKEN:{  <SINGLE_LINE_COMMENT:"\n"  | "\r"  | "\r\n">:DEFAULT}<IN_FORMAL_COMMENT>SPECIAL_TOKEN:{  <FORMAL_COMMENT:"*/">:DEFAULT}<IN_MULTI_LINE_COMMENT>SPECIAL_TOKEN:{  <MULTI_LINE_COMMENT:"*/">:DEFAULT}<IN_SINGLE_LINE_COMMENT, IN_FORMAL_COMMENT, IN_MULTI_LINE_COMMENT>MORE:{  <~[]>}TOKEN:{  <RULE:"rule">  | <WRITER:"writer">  | <TYPE:"type">  | <DS:"ds">  | <MAP:"map">  | <OUTPUTSCHEME:"outputscheme">  | <READER:"reader">  | <DATASOURCE:"datasource">  | <TRANSFORMER:"transformer">  | <CALL:"call">  | <PROPERTY:"property">  | <FIELD:"field">  | <ROOTID:"rootId">  | <FIELDID:"fieldId">  | <FIELDKEYS:"fieldKey">  | <FILTER:"filter">  | <CHECKER:"checker">  | <CONDITION:"condition">  | <TRANSACTIONTYPE:"transactiontype">  | <FUNCTION:"function">  | <VALUE:"value">  | <DOUBLE:"double">  | <SHORT:"short">  | <BYTE:"byte">  | <FLOAT:"float">  | <BOOLEAN:"boolean">  | <LONG:"long">  | <VOID:"void">  | <CHAR:"char">  | <INT:"int">}/* LITERALS */TOKEN:{  <INTEGER_LITERAL:<DECIMAL_LITERAL>(["l", "L"])?  | <HEX_LITERAL>(["l", "L"])?  | <OCTAL_LITERAL>(["l", "L"])?>  | <#DECIMAL_LITERAL:["1"-"9"](["0"-"9"])*>  | <#HEX_LITERAL:"0"["x", "X"](["0"-"9", "a"-"f", "A"-"F"])+>  | <#OCTAL_LITERAL:"0"(["0"-"7"])*>  | <FLOATING_POINT_LITERAL:(["0"-"9"])+"."(["0"-"9"])*(<EXPONENT>)?(["f", "F", "d", "D"])?  | "."(["0"-"9"])+(<EXPONENT>)?(["f", "F", "d", "D"])?  | (["0"-"9"])+<EXPONENT>(["f", "F", "d", "D"])?  | (["0"-"9"])+(<EXPONENT>)?["f", "F", "d", "D"]>  | <#EXPONENT:["e", "E"](["+", "-"])?(["0"-"9"])+>  | <CHARACTER_LITERAL:"'"((~["'", "\\", "\n", "\r"])  | ("\\"(["n", "t", "b", "r", "f", "\\", "'", "\""]  | ["0"-"7"](["0"-"7"])?  | ["0"-"3"]["0"-"7"]["0"-"7"])))"'">  | <STRING_LITERAL:"\""((~["\"", "\\", "\n", "\r"])  | ("\\"(["n", "t", "b", "r", "f", "\\", "'", "\""]  | ["0"-"7"](["0"-"7"])?  | ["0"-"3"]["0"-"7"]["0"-"7"])))*"\"">}/* IDENTIFIERS */TOKEN:{  <IDENTIFIER:<LETTER>(<LETTER>  | <DIGIT>)*>  | <#LETTER:["\u0024", "\u0041"-"\u005a", "\u005f", "\u0061"-"\u007a", "\u00c0"-"\u00d6", "\u00d8"-"\u00f6", "\u00f8"-"\u00ff", "\u0100"-"\u1fff", "\u3040"-"\u318f", "\u3300"-"\u337f", "\u3400"-"\u3d2d", "\u4e00"-"\u9fff", "\uf900"-"\ufaff"]>  | <#DIGIT:["\u0030"-"\u0039", "\u0660"-"\u0669", "\u06f0"-"\u06f9", "\u0966"-"\u096f", "\u09e6"-"\u09ef", "\u0a66"-"\u0a6f", "\u0ae6"-"\u0aef", "\u0b66"-"\u0b6f", "\u0be7"-"\u0bef", "\u0c66"-"\u0c6f", "\u0ce6"-"\u0cef", "\u0d66"-"\u0d6f", "\u0e50"-"\u0e59", "\u0ed0"-"\u0ed9", "\u1040"-"\u1049"]>}/* SEPARATORS */TOKEN:{  <LPAREN:"(">  | <RPAREN:")">  | <LBRACE:"{">  | <RBRACE:"}">  | <LBRACKET:"[">  | <RBRACKET:"]">  | <SEMICOLON:";">  | <COMMA:",">  | <DOT:".">  | <AT:"@">}/* OPERATORS */TOKEN:{  <ASSIGN:"=">  | <LT:"<">  | <BANG:"!">  | <TILDE:"~">  | <HOOK:"?">  | <COLON:":">  | <EQ:"==">  | <LE:"<=">  | <GE:">=">  | <NE:"!=">  | <SC_OR:"||">  | <SC_AND:"&&">  | <INCR:"++">  | <DECR:"--">  | <PLUS:"+">  | <MINUS:"-">  | <STAR:"*">  | <SLASH:"/">  | <BIT_AND:"&">  | <BIT_OR:"|">  | <XOR:"^">  | <REM:"%">  | <LSHIFT:"<<">  | <PLUSASSIGN:"+=">  | <MINUSASSIGN:"-=">  | <STARASSIGN:"*=">  | <SLASHASSIGN:"/=">  | <ANDASSIGN:"&=">  | <ORASSIGN:"|=">  | <XORASSIGN:"^=">  | <REMASSIGN:"%=">  | <LSHIFTASSIGN:"<<=">  | <RSIGNEDSHIFTASSIGN:">>=">  | <RUNSIGNEDSHIFTASSIGN:">>>=">  | <ELLIPSIS:"...">}SimpleNode Rule():{  Token t;  SimpleNode property;  SimpleNode component;  SimpleNode checker;  SimpleNode dataSource;  Rule rule = new Rule();  Function fun;}{  <RULE>t = <IDENTIFIER><LBRACE>(property = Property(){    rule.getProperties().add((Property)property.jjtGetValue());  }  )*((component = Writer()  | component = Transformer()  | component = Filter()  | component = TransactonType()  | component = Reader()){    rule.getComponents().add((Component)component.jjtGetValue());  }  )*[checker = Checker(){    rule.setChecker((Checker)checker.jjtGetValue());  }  ]((dataSource = DataSource()){    rule.getDataSources().add((DataSource)dataSource.jjtGetValue());  }  )*((fun = MethodDeclaration()){    rule.getFunctions().add(fun);  }  )*<RBRACE>{    rule.setName(t.image);    jjtThis.jjtSetValue(rule);    return jjtThis;  }}SimpleNode Property():{  Token name;  Token value;}{  <PROPERTY>name = <IDENTIFIER><ASSIGN>value = <STRING_LITERAL><SEMICOLON>{    Property property = new Property();    property.setName(name.image);    property.setValue(value.image.replace("\"", ""));    jjtThis.jjtSetValue(property);    return jjtThis;  }}SimpleNode Field():{  Token name;  Token type;  Token value;}{  <FIELD>name = <IDENTIFIER><COLON>type = TypeSpecifier()<ASSIGN>value = <STRING_LITERAL><SEMICOLON>{    Field field = new Field();    field.setName(name.image);    field.setType(type.image);    field.setValue(value.image.replace("\"", ""));    jjtThis.jjtSetValue(field);    return jjtThis;  }}SimpleNode Reader():{  Token t;  Token type;  Token ds;  Token map;  Token call;  Token outputScheme;  SimpleNode field;  SimpleNode property;  DataReader dataReader = new DataReader();}{  <READER>t = <IDENTIFIER><LBRACE>(property = Property(){    dataReader.getProperties().add((Property)property.jjtGetValue());  }  )*<TYPE><ASSIGN>type = <STRING_LITERAL><SEMICOLON><DS><ASSIGN>ds = <STRING_LITERAL><SEMICOLON><MAP><ASSIGN>map = <STRING_LITERAL><SEMICOLON><OUTPUTSCHEME><ASSIGN>outputScheme = <STRING_LITERAL><SEMICOLON>(<CALL><ASSIGN>call = <STRING_LITERAL><SEMICOLON>{    dataReader.getCalleds().add(call.image.replace("\"", ""));  }  )*(field = Field(){    dataReader.getFields().add((Field)field.jjtGetValue());  }  )*<RBRACE>{    dataReader.setName(t.image);    dataReader.setType(type.image.replace("\"", ""));    dataReader.setDataSource(ds.image.replace("\"", ""));    dataReader.setMap(map.image.replace("\"", ""));    dataReader.setOutputScheme(outputScheme.image.replace("\"", ""));    jjtThis.jjtSetValue(dataReader);    return jjtThis;  }}SimpleNode Transformer():{  Token t;  Token type;  Token outputScheme;  Token call;  SimpleNode field;  SimpleNode property;  Transformer transformer = new Transformer();}{  <TRANSFORMER>t = <IDENTIFIER><LBRACE>(property = Property(){    transformer.getProperties().add((Property)property.jjtGetValue());  }  )*<TYPE><ASSIGN>type = <STRING_LITERAL><SEMICOLON><OUTPUTSCHEME><ASSIGN>outputScheme = <STRING_LITERAL><SEMICOLON>(<CALL><ASSIGN>call = <STRING_LITERAL><SEMICOLON>{    transformer.getCalleds().add(call.image.replace("\"", ""));  }  )*(field = Field(){    transformer.getFields().add((Field)field.jjtGetValue());  }  )*<RBRACE>{    transformer.setName(t.image);    transformer.setOutputScheme(outputScheme.image.replace("\"", ""));    transformer.setType(type.image.replace("\"", ""));    jjtThis.jjtSetValue(transformer);    return jjtThis;  }}SimpleNode Checker():{  Token t;  Token type;  Token condition;  SimpleNode property;  Checker checker = new Checker();}{  <CHECKER>t = <IDENTIFIER><LBRACE>(property = Property(){    checker.getProperties().add((Property)property.jjtGetValue());  }  )*<TYPE><ASSIGN>type = <STRING_LITERAL><SEMICOLON><CONDITION><ASSIGN>condition = <STRING_LITERAL><SEMICOLON><RBRACE>{    checker.setName(t.image);    checker.setType(type.image.replace("\"", ""));    checker.setCondition(condition.image.replace("\"", ""));    jjtThis.jjtSetValue(checker);    return jjtThis;  }}SimpleNode Filter():{  Token t;  Token type;  Token outputScheme;  Token condition;  Token call;  SimpleNode field;  SimpleNode property;  Filter filter = new Filter();}{  <FILTER>t = <IDENTIFIER><LBRACE>(property = Property(){    filter.getProperties().add((Property)property.jjtGetValue());  }  )*<TYPE><ASSIGN>type = <STRING_LITERAL><SEMICOLON><CONDITION><ASSIGN>condition = <STRING_LITERAL><SEMICOLON><OUTPUTSCHEME><ASSIGN>outputScheme = <STRING_LITERAL><SEMICOLON>(<CALL><ASSIGN>call = <STRING_LITERAL><SEMICOLON>{    filter.getCalleds().add(call.image.replace("\"", ""));  }  )*(field = Field(){    filter.getFields().add((Field)field.jjtGetValue());  }  )*<RBRACE>{    filter.setName(t.image);    filter.setOutputScheme(outputScheme.image.replace("\"", ""));    filter.setType(type.image.replace("\"", ""));    filter.setCondition(condition.image.replace("\"", ""));    jjtThis.jjtSetValue(filter);    return jjtThis;  }}SimpleNode TransactonType():{  Token t;  Token type;  Token outputScheme;  Token value;  Token call;  SimpleNode field;  SimpleNode property;  TransactonType transactonType = new TransactonType();}{  <TRANSACTIONTYPE>t = <IDENTIFIER><LBRACE>(property = Property(){    transactonType.getProperties().add((Property)property.jjtGetValue());  }  )*<TYPE><ASSIGN>type = <STRING_LITERAL><SEMICOLON><VALUE><ASSIGN>value = <STRING_LITERAL><SEMICOLON><OUTPUTSCHEME><ASSIGN>outputScheme = <STRING_LITERAL><SEMICOLON>(<CALL><ASSIGN>call = <STRING_LITERAL><SEMICOLON>{    transactonType.getCalleds().add(call.image.replace("\"", ""));  }  )*(field = Field(){    transactonType.getFields().add((Field)field.jjtGetValue());  }  )*<RBRACE>{    transactonType.setName(t.image);    transactonType.setOutputScheme(outputScheme.image.replace("\"", ""));    transactonType.setType(type.image.replace("\"", ""));    transactonType.setValue(value.image.replace("\"", ""));    jjtThis.jjtSetValue(transactonType);    return jjtThis;  }}SimpleNode Writer():{  Token t;  Token type;  Token ds;  Token rootId;  Token fieldId;  Token fieldKeys;  Token call;  Token outputScheme;  SimpleNode field;  SimpleNode property;  DataWriter dataWriter = new DataWriter();}{  <WRITER>t = <IDENTIFIER><LBRACE>(property = Property(){    dataWriter.getProperties().add((Property)property.jjtGetValue());  }  )*<TYPE><ASSIGN>type = <STRING_LITERAL><SEMICOLON><DS><ASSIGN>ds = <STRING_LITERAL><SEMICOLON><ROOTID><ASSIGN>rootId = <STRING_LITERAL><SEMICOLON><FIELDID><ASSIGN>fieldId = <STRING_LITERAL><SEMICOLON><FIELDKEYS><ASSIGN>fieldKeys = <STRING_LITERAL><SEMICOLON><OUTPUTSCHEME><ASSIGN>outputScheme = <STRING_LITERAL><SEMICOLON>(<CALL><ASSIGN>call = <STRING_LITERAL><SEMICOLON>{    dataWriter.getCalleds().add(call.image.replace("\"", ""));  }  )*(field = Field(){    dataWriter.getFields().add((Field)field.jjtGetValue());  }  )*<RBRACE>{    dataWriter.setName(t.image);    dataWriter.setType(type.image.replace("\"", ""));    dataWriter.setDataSource(ds.image.replace("\"", ""));    dataWriter.setOutputScheme(outputScheme.image.replace("\"", ""));    dataWriter.setRootId(rootId.image.replace("\"", ""));    dataWriter.setFieldId(fieldId.image.replace("\"", ""));    dataWriter.setFieldKeys(fieldKeys.image.replace("\"", ""));    jjtThis.jjtSetValue(dataWriter);    return jjtThis;  }}SimpleNode DataSource():{  Token name;  Token type;  SimpleNode property;  DataSource dataSource = new DataSource();}{  <DATASOURCE>name = <IDENTIFIER><LBRACE>(property = Property(){    dataSource.getProperties().add((Property)property.jjtGetValue());  }  )*<TYPE><ASSIGN>type = <STRING_LITERAL><SEMICOLON><RBRACE>{    dataSource.setName(name.image);    dataSource.setType(type.image.replace("\"", ""));    jjtThis.jjtSetValue(dataSource);    return jjtThis;  }}Token TypeSpecifier():{  Token t;}{  (t = <VOID>  | t = <CHAR>  | t = <BOOLEAN>  | t = <INT>  | t = <LONG>  | t = <FLOAT>  | t = <DOUBLE>  | t = <SHORT>  | t = <BYTE>  | LOOKAHEAD({    isType(getToken(1).image)  }  )t = TypedefName()){    return t;  }}Token TypedefName():{  Token t;}{  t = <IDENTIFIER>{    return t;  }}Token Type():{  Token t;}{  (LOOKAHEAD(2)t = ReferenceType()  | t = PrimitiveType()){    jjtThis.jjtSetValue(t.image.replace("\"", ""));    return t;  }}Token PrimitiveType():{  Token t;}{  (t = "boolean"  | t = "char"  | t = "byte"  | t = "short"  | t = "int"  | t = "long"  | t = "float"  | t = "double"){    jjtThis.jjtSetValue(t.image.replace("\"", ""));    return t;  }}Token ReferenceType():{  Token t;}{  (t = PrimitiveType()(LOOKAHEAD(2)"[""]")+  | (t = ClassOrInterfaceType())(LOOKAHEAD(2)"[""]")*){    jjtThis.jjtSetValue(t.image.replace("\"", ""));    return t;  }}Token ClassOrInterfaceType():{  Token t;}{  t = <IDENTIFIER>{    jjtThis.jjtSetValue(t.image.replace("\"", ""));    return t;  }  [LOOKAHEAD(2)TypeArguments()](LOOKAHEAD(2)"."<IDENTIFIER>[LOOKAHEAD(2)TypeArguments()])*}void TypeArguments():{}{  "<"TypeArgument()(","TypeArgument())*">"}void TypeArgument():{}{  ReferenceType()  | "?"[WildcardBounds()]}void WildcardBounds():{}{  "extends"ReferenceType()  | "super"ReferenceType()}void TypeBound():{}{  "extends"ClassOrInterfaceType()("&"ClassOrInterfaceType())*}//  Method --------------------------------------------------------Function MethodDeclaration():{  Function fun = new Function();  Token block = null;  Token name;  Token resultType;  List<FunctionParameter>params;}{  // Modifiers already matched in the caller!<FUNCTION>name = <IDENTIFIER>{    fun.setName(name.image.replace("\"", ""));  }  params = FormalParameters()":"resultType = ResultType(){    fun.setReturnType(resultType.image.replace("\"", ""));  }  <LBRACE>[block = <IDENTIFIER>]<RBRACE>{    if (block != null){      fun.setBlock(block.image.replace("\"", ""));    }    fun.setParametrs(params);    jjtThis.jjtSetValue(fun);    return fun;  }}List<FunctionParameter>FormalParameters():{  List<FunctionParameter>params = new ArrayList<FunctionParameter>();  FunctionParameter param;}{  ("("[param = FormalParameter(){    params.add(param);  }  (","param = FormalParameter(){    params.add(param);  }  )*]")"){    jjtThis.jjtSetValue(params);    return params;  }}FunctionParameter FormalParameter():{  FunctionParameter param = new FunctionParameter();  Token name;  Token type;}{  (type = Type()name = <IDENTIFIER>){    param.setName(name.image.replace("\"", ""));    param.setType(type.image.replace("\"", ""));    jjtThis.jjtSetValue(param);    return param;  }}Token ResultType():{  Token t;}{  (t = "void"  | t = Type()){    jjtThis.jjtSetValue(t.image.replace("\"", ""));    return t;  }}